<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>PDF XMP-Metadaten-Viewer</title>
</head>
<body>
  <h1>PDF XMP-Metadaten-Viewer</h1>
  <input type="file" id="pdfInput" accept="application/pdf">
  <pre id="output"></pre>

  <script>
    document.getElementById('pdfInput').addEventListener('change', async function () {
      const file = this.files[0];
      if (!file) return;

      const arrayBuffer = await file.arrayBuffer();
      const uint8Array = new Uint8Array(arrayBuffer);
      const text = new TextDecoder().decode(uint8Array);

      // Versuchen, den XMP-Metadatenblock zu extrahieren
      const xmpStart = text.indexOf('<x:xmpmeta');
      const xmpEnd = text.indexOf('</x:xmpmeta>');
      // Überprüfen auf Variablen-Metadaten im RDF-Format
      const variablesMatch = text.match(/<jspdf:metadata>([^<]*?)<\/jspdf:metadata>/);
      if (variablesMatch && variablesMatch[1]) {
        try {
          const variablesJson = JSON.parse(variablesMatch[1]);
          console.log('Variablen-Metadaten gefunden:', variablesJson);
        } catch (e) {
          console.error('Fehler beim Parsen der Variablen-Metadaten als JSON:', e);
        }
      }

      if (xmpStart !== -1 && xmpEnd !== -1) {
        const xmpData = text.substring(xmpStart, xmpEnd + 12); // 12 = Länge von '</x:xmpmeta>'
        document.getElementById('output').textContent = xmpData;
      } else {
        document.getElementById('output').textContent = 'Keine XMP-Metadaten im PDF gefunden.';
      }
    });
  </script>
</body>
</html>
